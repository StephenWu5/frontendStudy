<head>
    <meta charset="UTF-8">
    <title>canvaså…ƒç´ ç¤ºä¾‹</title>
</head>

<body onload="draw('canvas');">
    <h1>canvaså…ƒç´ ç¤ºä¾‹</h1>
    <canvas width="400" height="300" id='canvas' />
</body>
<script>
    function draw(id) {
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        context.fillStyle = "#EEEEFF";
        context.fillRect(0, 0, 400, 300);
        image = new Image();
        image.src = "./ç”Ÿæ´»ä¸­çš„å¹¸ç¦.png";
        image.onload = function () {
            console.log(image, 'image');
            drawImg(context, image);
        };
        // console.log(image.src, 'image')
    }
    function drawImg(context, image) {
        for (var i = 0; i < 7; i++)
            context.drawImage(image, 0 + i * 50, 0 + i * 25, 100, 100);
    }
    // 
    function draw(id) {
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        context.fillStyle = "#EEEEFF";
        context.fillRect(0, 0, 400, 300);
        image = new Image();
        image.src = "./ç”Ÿæ´»ä¸­çš„å¹¸ç¦.png";
        image.onload = function () {
            drawImg(context, image);
        };
    }
    function drawImg(context, image) {
        var i = 0;
        // é¦–å…ˆè°ƒç”¨è¯¥æ–¹æ³•ç»˜åˆ¶åŸå§‹å›¾åƒ
        context.drawImage(image, 0, 0, 100, 100);
        // ç»˜åˆ¶å°†å±€éƒ¨åŒºåŸŸè¿›è¡Œæ”¾å¤§åçš„å›¾åƒ
        context.drawImage(image, 23, 5, 57, 80, 110, 0, 100, 100);
    }
    // é¡µé¢å¹³é“ºæ•ˆæœğŸ¦
    function draw(id) {
        var image = new Image();
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        image.src = "./ç”Ÿæ´»ä¸­çš„å¹¸ç¦.png";
        image.onload = function () {
            drawImg(canvas, context, image);
        };
    }
    function drawImg(canvas, context, image) {
        // å¹³é“ºæ¯”ä¾‹
        var scale = 5
        // ç¼©å°åå›¾åƒå®½åº¦
        var n1 = image.width / scale;
        // ç¼©å°åå›¾åƒé«˜åº¦
        var n2 = image.height / scale;
        // å¹³é“ºæ¨ªå‘ä¸ªæ•°
        var n3 = canvas.width / n1;
        // å¹³é“ºçºµå‘ä¸ªæ•°
        var n4 = canvas.height / n2;
        for (var i = 0; i < n3; i++)
            for (var j = 0; j < n4; j++)
                context.drawImage(image, i * n1, j * n2, n1, n2);
    }
    function draw(id) {
        var image = new Image();
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        image.src = "./ç”Ÿæ´»ä¸­çš„å¹¸ç¦.png";
        image.onload = function () {
            // åˆ›å»ºå¡«å……æ ·å¼ï¼Œå…¨æ–¹å‘å¹³é“º
            var ptrn = context.createPattern(image, 'repeat');
            console.log(ptrn, 'ptrn');
            // æŒ‡å®šå¡«å……æ ·å¼
            context.fillStyle = ptrn;
            // å¡«å……ç”»å¸ƒ
            context.fillRect(0, 0, 400, 300);
        };
    }
    function draw(id) {
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        var gr = context.createLinearGradient(0, 400, 300, 0);
        gr.addColorStop(0, 'rgb(255,255,0)');
        gr.addColorStop(1, 'rgb(0,255,255)');
        context.fillStyle = gr;
        context.fillRect(0, 0, 400, 300);
        image = new Image();
        image.onload = function () {
            drawImg(context, image);
        };
        image.src = "./ç”Ÿæ´»ä¸­çš„å¹¸ç¦.png";
    }

    function drawImg(context, image) {
        create5StarClip(context);
        context.drawImage(image, -50, -150, 300, 300);
        imagedata = context.getImageData(0, 0, image.width, image.height);
        console.log(imagedata, 'imagedata');
    }

    function create5StarClip(context) {
        var n = 0;
        var dx = 100;
        var dy = 0;
        var s = 150;
        context.beginPath();
        context.translate(100, 150);
        var x = Math.sin(0);
        var y = Math.cos(0);
        var dig = Math.PI / 5 * 4;
        for (var i = 0; i < 5; i++) {
            var x = Math.sin(i * dig);
            var y = Math.cos(i * dig);
            context.lineTo(dx + x * s, dy + y * s);
        }
        context.clip();
    }
    function draw(id) {
        let canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        let context = canvas.getContext('2d');
        let image = new Image();
        image.src = "./ç”Ÿæ´»ä¸­çš„å¹¸ç¦.png";
        image.onload = function () {
            context.drawImage(image, 0, 0);
            let imagedata = context.getImageData(0, 0, image.width, image.height);
            console.log(imagedata, 'imagedata');
            for (var i = 0, n = imagedata.data.length; i < n; i += 4) {
                imagedata.data[i + 0] = 255 - imagedata.data[i + 0]; // red
                imagedata.data[i + 1] = 255 - imagedata.data[i + 1]; // green
                imagedata.data[i + 2] = 255 - imagedata.data[i + 2]; // blue
            }
            context.putImageData(imagedata, 0, 0);
        };
    }
    function draw(id) {
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        var oprtns = new Array(
            "source-atop",
            "source-in",
            "source-out",
            "source-over",
            "destination-atop",
            "destination-in",
            "destination-out",
            "destination-over",
            "lighter",
            "copy",
            "xor"
        );
        i = 8;   // è¯»è€…å¯è‡ªè¡Œä¿®æ”¹è¯¥å‚æ•°æ¥æ˜¾ç¤ºæƒ³è¦æŸ¥çœ‹çš„ç»„åˆæ•ˆæœ
        // ç»˜åˆ¶åŸæœ‰å›¾å½¢(è“è‰²é•¿æ–¹å½¢)
        context.fillStyle = "blue";
        context.fillRect(10, 10, 60, 60);
        /*è®¾ç½®ç»„åˆæ–¹å¼,ä»ç»„åˆçš„å‚æ•°æ•°ç»„ä¸­æŒ‘é€‰ç»„åˆæ–¹å¼,æ­¤å¤„å› ä¸ºiæ˜¯8,
        æ‰€ä»¥é€‰æ‹©oprtnsæ•°ç»„ä¸­ç¬¬9(æ•°ç»„ä»0å¼€å§‹è®¡ç®—)ä¸ªç»„åˆæ–¹å¼lighter*/
        // context.globalCompositeOperation = oprtns[i];
        // è®¾ç½®æ–°å›¾å½¢(çº¢è‰²åœ†å½¢)
        context.beginPath();
        context.fillStyle = "red";
        context.arc(60, 60, 30, 0, Math.PI * 2, false);
        context.fill();
    }


    function draw(id) {
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        var oprtns = new Array(
            "source-atop",
            "source-in",
            "source-out",
            "source-over",
            "destination-atop",
            "destination-in",
            "destination-out",
            "destination-over",
            "lighter",
            "copy",
            "xor"
        );
        i = 8;   // è¯»è€…å¯è‡ªè¡Œä¿®æ”¹è¯¥å‚æ•°æ¥æ˜¾ç¤ºæƒ³è¦æŸ¥çœ‹çš„ç»„åˆæ•ˆæœ
        // ç»˜åˆ¶åŸæœ‰å›¾å½¢(è“è‰²é•¿æ–¹å½¢)
        context.fillStyle = "blue";
        context.fillRect(10, 10, 60, 60);
        /*è®¾ç½®ç»„åˆæ–¹å¼,ä»ç»„åˆçš„å‚æ•°æ•°ç»„ä¸­æŒ‘é€‰ç»„åˆæ–¹å¼,æ­¤å¤„å› ä¸ºiæ˜¯8,
        æ‰€ä»¥é€‰æ‹©oprtnsæ•°ç»„ä¸­ç¬¬9(æ•°ç»„ä»0å¼€å§‹è®¡ç®—)ä¸ªç»„åˆæ–¹å¼lighter*/
        context.globalCompositeOperation = oprtns[i];
        // è®¾ç½®æ–°å›¾å½¢(çº¢è‰²åœ†å½¢)
        context.beginPath();
        context.fillStyle = "red";
        context.arc(60, 60, 30, 0, Math.PI * 2, false);
        context.fill();
    }

    function draw(id) {
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        context.globalCompositeOperation = "darken";
        var image = new Image();
        image.src = "./ç”Ÿæ´»ä¸­çš„å¹¸ç¦.png";
        image.onload = function () {
            context.drawImage(image, 0, 0);
            var image2 = new Image();
            image2.src = "person.jpg";
            image2.onload = function () {
                context.drawImage(image2, 0, 0);
            };
        };
    }
    function draw(id) {
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        context.fillStyle = '#00f';
        context.font = 'italic 30px sans-serif';
        context.textBaseline = 'top';
        // å¡«å……å­—ç¬¦ä¸²
        context.fillText('ç¤ºä¾‹æ–‡å­—', 0, 0);
        context.font = 'bold  30px sans-serif';
        // è½®å»“å­—ç¬¦ä¸²
        context.strokeText('ç¤ºä¾‹æ–‡å­—', 0, 50);
    }
    function draw(id) {
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        context.font = 'italic 20px sans-serif';
        /* å®šä¹‰ç»˜åˆ¶æ–‡å­—*/
        var txt = "å­—ç¬¦ä¸²çš„å®½åº¦ä¸º";
        /* è·å–æ–‡å­—å®½åº¦ */
        var tm1 = context.measureText(txt);
        console.log(tm1, 'tm1');
        /* ç»˜åˆ¶æ–‡å­— */
        context.fillText(txt, 10, 30);
        context.fillText(tm1.width, tm1.width + 10, 30);
        /* æ”¹å˜å­—ä½“ */
        context.font = "bold  30px sans-serif";
        /* é‡æ–°è·å–æ–‡å­—å®½åº¦ */
        var tm2 = context.measureText(txt);
        /* é‡æ–°ç»˜åˆ¶æ–‡å­—*/
        context.fillText(txt, 10, 70);
        context.fillText(tm2.width, tm2.width + 10, 70);
    }
    function draw(id) {
        var canvas = document.getElementById(id);
        if (canvas == null)
            return false;
        var context = canvas.getContext('2d');
        context.fillStyle = "rgb(0, 0, 255)";
        context.fillRect(0, 0, canvas.width, canvas.height);
        context.fillStyle = "rgb(255, 255, 0)";
        context.fillRect(10, 20, 50, 50);
        // è¿™ç§æ–¹å¼ä¸å…è®¸
        // window.location = canvas.toDataURL("image/jpeg");
        base64Data = canvas.toDataURL("image/jpeg");
        // è¿™æ˜¯å…è®¸çš„åˆ©ç”¨iframeçš„srcå±æ€§
        var iframe = "<iframe width='100%' height='100%' src='" + base64Data + "'></iframe>";
        var x = window.open();
        x.document.open();
        x.document.write(iframe);
        x.document.close();
    }
</script>

</html>